<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<form method="post" enctype="multipart/form-data" id="form">
    <input type="file" name="file" id="file" accept="text/csv"/>
</form>
<br>

<button onclick="createOrEdit()">Create</button>
<script>
    const url = "http://localhost:8080"

    const file = document.getElementById("file")
    file.addEventListener("change", () =>
        fetch(`${url}/game/batch`, { method: "POST", body: new FormData(document.getElementById("form")) }).then(refresh))

    const inpName = document.createElement("input")
    inpName.placeholder = "Name"
    inpName.maxLength = 255
    const inpProgram = document.createElement("input")
    inpProgram.placeholder = "Program"
    inpProgram.maxLength = 255
    const inpFaculty = document.createElement("input")
    inpFaculty.placeholder = "Faculty"
    inpFaculty.maxLength = 255


    document.body.appendChild(inpName)
    document.body.appendChild(inpProgram)
    document.body.appendChild(inpFaculty)
    document.body.append(document.createElement("br"))
    const t = document.createElement("table")
    document.body.append(t)

    function createOrEdit(i) {
        if (!inpName.value.trim() || !inpProgram.value.trim() || !inpFaculty.value.trim()) {
            alert("Name, program and faculty must not be blank.")
            return
        }

        fetch(`${url}/game/${i ?? -1}`, {
            method: "PUT",
                body: JSON.stringify({"name": inpName.value, "program": inpProgram.value, "faculty": inpFaculty.value}),
            headers: {"Content-Type": "application/json"}
        }).then(refresh)
        inpName.value = ""
        inpProgram.value = ""
        inpFaculty.value = ""
    }

    function refresh() {
        fetch(`${url}/game`).then(c => c.json()).then(render)
        function render(array) {
            t.innerHTML = "<thead><tr><th>ID</th><th>Name</th><th>Program</th><th>Faculty</th></tr></thead>"
            const tb = t.createTBody()
            for (let entity of array) {
                const tr = tb.insertRow()
                const id = tr.insertCell(), name = tr.insertCell(), program = tr.insertCell(), faculty = tr.insertCell(), edit = tr.insertCell()
                id.appendChild(document.createTextNode(entity.id))
                name.appendChild(document.createTextNode(entity.name))
                program.appendChild(document.createTextNode(entity.program))
                faculty.appendChild(document.createTextNode(entity.faculty))

                const editBtn = document.createElement("button")
                editBtn.textContent = "Edit Item"
                editBtn.onclick = () => createOrEdit(entity.id)
                edit.appendChild(editBtn)
                const del = document.createElement("button")
                del.textContent = "Delete"
                del.onclick = () => { fetch(`${url}/game/${entity.id}`, { method: "DELETE" }).then(refresh) }
                edit.appendChild(del)
            }
        }
    }
    refresh()
</script>

</body>
</html>